function $(id){return document.getElementById(id)}function storageGet(k,d){try{const v=localStorage.getItem(k);return v?JSON.parse(v):d}catch{return d}}function storageSet(k,v){try{localStorage.setItem(k,JSON.stringify(v))}catch{}}function prefersReducedMotion(){return window.matchMedia&&window.matchMedia('(prefers-reduced-motion: reduce)').matches}
function injectHeaderFooter(activePage){try{if(!document.getElementById('dre-mobile-nav-style')){var s=document.createElement('style');s.id='dre-mobile-nav-style';s.textContent='@media (hover:none) and (pointer:coarse){header .nav nav{display:none!important}header .nav .menu-btn{display:inline-flex!important;align-items:center;justify-content:center}header .nav.show-menu nav{display:block!important;position:absolute;top:56px;left:var(--pad);right:var(--pad);background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:8px}header .nav.show-menu nav a{display:block;margin:4px 0}}';document.head.appendChild(s)}}catch(e){}
try{if(!document.getElementById('dre-force-hamburger-style')){var s2=document.createElement('style');s2.id='dre-force-hamburger-style';s2.textContent='header .nav.force-hamburger nav{display:none!important}header .nav.force-hamburger .menu-btn{display:inline-flex!important;align-items:center;justify-content:center}header .nav.force-hamburger.show-menu nav{display:block!important;position:absolute;top:56px;left:var(--pad);right:var(--pad);background:#fff;border:1px solid var(--border);border-radius:12px;box-shadow:var(--shadow);padding:8px}header .nav.force-hamburger.show-menu nav a{display:block;margin:4px 0}';document.head.appendChild(s2)}}catch(e){}
var h='';h+='<header>\n';h+='  <div class="nav">\n';h+='    <a href="index.html" class="brand" aria-label="Home"><div class="logo">DR</div> <span>DeFiâ€‘RealEstate (Demo)</span></a>\n';h+='    <div class="grow"></div>\n';h+='    <button class="menu-btn" id="menuBtn" aria-label="Menu" aria-expanded="false" aria-controls="primaryNav">â˜°</button>\n';h+='    <nav role="navigation" aria-label="Primary" id="primaryNav">\n';h+='      <a href="index.html" data-page="home" data-i18n="nav_home">Home</a>\n';h+='      <a href="dividends.html" data-page="dividends" data-i18n="nav_dividends">Dividend Tracker</a>\n';h+='      <a href="growth.html" data-page="growth" data-i18n="nav_growth">Growth & Forecast</a>\n';h+='      <a href="marketplace.html" data-page="market" data-i18n="nav_market">Marketplace</a>\n';h+='      <a href="admin.html" data-page="admin" data-i18n="nav_admin">Admin</a>\n';h+='    </nav>\n';h+='    <div class="controls">\n';h+='      <select id="langSel" aria-label="Language">\n';h+='        <option value="en">ðŸ‡ºðŸ‡¸ English</option>\n';h+='        <option value="vi">ðŸ‡»ðŸ‡³ Tiáº¿ng Viá»‡t</option>\n';h+='      </select>\n';h+='    </div>\n';h+='  </div>\n';h+='</header>';
var f='';f+='<footer role="contentinfo">\n';f+='  <div class="foot">\n';f+='    <div>Â© <span id="yr"></span> DeFiâ€‘RealEstate â€¢ <span data-i18n="foot_rights">All rights reserved.</span></div>\n';f+='  </div>\n';f+='</footer>';
document.body.insertAdjacentHTML('afterbegin',h);document.body.insertAdjacentHTML('beforeend',f);var yr=document.getElementById('yr');if(yr)yr.textContent=String((new Date).getFullYear());
try{var container=document.querySelector('header .nav');var menuBtn=document.getElementById('menuBtn');var nav=document.getElementById('primaryNav');if(menuBtn&&container&&nav){menuBtn.addEventListener('click',function(){var open=container.classList.toggle('show-menu');menuBtn.setAttribute('aria-expanded',String(open))});var links=nav.querySelectorAll('a');links.forEach(function(a){a.addEventListener('click',function(){if(container.classList.contains('show-menu')){container.classList.remove('show-menu');menuBtn.setAttribute('aria-expanded','false')}})});function applyNavWrapMode(){var disp=getComputedStyle(nav).display;if(disp==='none'){container.classList.remove('force-hamburger');return}var linkEls=[].slice.call(nav.querySelectorAll('a'));if(linkEls.length===0){container.classList.remove('force-hamburger');return}var top0=linkEls[0].offsetTop;var wrapped=linkEls.some(function(el){return el.offsetTop!==top0});if(wrapped)container.classList.add('force-hamburger');else container.classList.remove('force-hamburger')}
var _raf;function onResize(){cancelAnimationFrame(_raf);_raf=requestAnimationFrame(applyNavWrapMode)}window.addEventListener('resize',onResize,{passive:true});setTimeout(applyNavWrapMode,0)}}catch(e){}
if(typeof initHeader==='function')initHeader(activePage)}
function openModal(modalId,backdropId){var m=$(modalId),b=$(backdropId);if(m&&b){b.classList.add('show');m.classList.add('show');var focusables=m.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');var first=focusables[0],last=focusables[focusables.length-1];function trap(e){if(e.key==='Tab'){if(e.shiftKey&&document.activeElement===first){e.preventDefault();last&&last.focus()}else if(!e.shiftKey&&document.activeElement===last){e.preventDefault();first&&first.focus()}}else if(e.key==='Escape'){closeModal(m.id,b.id)}}m.dataset.trap='1';document.addEventListener('keydown',trap);m.__trapHandler=trap;setTimeout(function(){first&&first.focus&&first.focus()},0)}}
function closeModal(modalId,backdropId){var m=$(modalId),b=$(backdropId);if(m&&b){b.classList.remove('show');m.classList.remove('show');if(m.__trapHandler){document.removeEventListener('keydown',m.__trapHandler);delete m.__trapHandler}}}
function onlyDigits(s){try{return(s||'').replace(/\D/g,'')}catch{return''}}function luhnCheck(num){var s=onlyDigits(num);if(!s||s.length<13||s.length>19)return false;var sum=0,dbl=false;for(var i=s.length-1;i>=0;i--){var n=s.charCodeAt(i)-48;if(n<0||n>9)return false;if(dbl){n*=2;if(n>9)n-=9}sum+=n;dbl=!dbl}return sum%10===0}function validExpiry(val){if(!val)return false;var m=String(val).match(/^(\d{2})\s*\/\s*(\d{2}|\d{4})$/);if(!m)return false;var mm=parseInt(m[1],10),yy=parseInt(m[2],10);if(mm<1||mm>12)return false;if(yy<100)yy+=2000;var now=new Date(),y=now.getFullYear(),mon=now.getMonth()+1;return yy>y||yy===y&&mm>=mon}function formatCardNumber(v){var s=onlyDigits(v).slice(0,19);return s.replace(/(.{4})/g,'$1 ').trim()}

// Shared investment helpers
function getInvestments(p){return Array.isArray(p&&p.investments)?p.investments:[]}
function sumCommitted(p){var i=getInvestments(p);if(!i.length)return 0;return i.reduce(function(s,x){return s+((x&&x.status==='approved')?(+x.amount||0):0)},0)}
function capMax(p){return Math.max(0,Math.floor((+((p&&p.price)||0))*0.49))}
function availCap(p){return Math.max(0,capMax(p)-sumCommitted(p))}

// Tooltip behavior (global, one-time)
if(!window.__dreTooltipInit){window.__dreTooltipInit=true;document.addEventListener('click',function(e){var btn=e.target.closest&&e.target.closest('.tooltip .icon-btn');if(!btn)return;var wrap=btn.closest('.tooltip');if(!wrap)return;wrap.classList.add('show');setTimeout(function(){wrap.classList.remove('show')},1200)});document.addEventListener('keydown',function(e){if(e.key!=='Enter'&&e.key!==' ')return;var el=document.activeElement;if(!el)return;var btn=el.closest&&el.closest('.tooltip .icon-btn');if(!btn)return;var wrap=btn.closest('.tooltip');if(!wrap)return;wrap.classList.add('show');setTimeout(function(){wrap.classList.remove('show')},1200)})}
