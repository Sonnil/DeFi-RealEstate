<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="DeFi‑RealEstate: browse fractional real estate deals, track dividends, and forecast growth.">
<title>DeFi‑RealEstate — Home</title>
<link rel="preconnect" href="https://cdn.pixabay.com" crossorigin>
<link rel="preconnect" href="https://images.unsplash.com" crossorigin>
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64'%3E%3Ctext y='50' font-size='48'%3E🏠%3C/text%3E%3C/svg%3E" />
<!-- Critical CSS for first paint; full stylesheet loaded asynchronously below -->
<style>
  :root{--bg:#0b0d12;--card:#111623;--text:#e9eef5;--muted:#a9b2c2;--primary:#2e7cf6}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Inter,Arial,sans-serif}
  main{padding:16px}
  .card{background:var(--card);border-radius:12px;padding:20px}
  .hero{display:grid;grid-template-columns:1.1fr 1fr;gap:20px;align-items:stretch}
  .badge{display:inline-block;background:#1b2133;color:#bfe4ff;padding:6px 10px;border-radius:999px;font-size:14px}
  h1{font-size:clamp(28px,4vw,40px);margin:10px 0;line-height:1.2}
  p{color:var(--muted);margin:8px 0 12px}
  .cta{display:flex;gap:10px;flex-wrap:wrap}
  button.primary{background:var(--primary);color:#fff;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
  button.secondary{background:#1b2133;color:#e9eef5;border:1px solid #2a3550;padding:10px 14px;border-radius:8px;cursor:pointer}
  .kpi{display:flex;gap:10px;flex-wrap:wrap}
  .chip{background:#121a2b;border:1px solid #1f2a44;color:#cdd7e8;padding:8px 10px;border-radius:999px}
  .illus{position:relative;border-radius:12px;overflow:hidden;min-height:260px}
  .illus .ph{position:absolute;inset:0;background:linear-gradient(100deg,#0e1629 20%,#111a2f 40%,#0e1629 60%);background-size:200% 100%;animation:ph 1.2s ease-in-out infinite;transition:opacity .4s ease}
  @keyframes ph{0%{background-position:200% 0}100%{background-position:-200% 0}}
  .hero-img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;opacity:0;transition:opacity 1.8s ease,filter .6s ease,transform .6s ease;filter:blur(12px);transform:scale(1.02)}
  .hero-img.active{opacity:1}
  .hero-img.is-loaded{filter:blur(0);transform:none}
  @media (max-width:720px){
    .hero{grid-template-columns:1fr;align-items:flex-start}
    .hero .illus{display:none}
    .hero p{max-width:none;word-break:normal;white-space:normal}
    .kpi{flex-direction:column}
    .chip{width:100%;text-align:left}
    main{padding:12px}
  }
</style>
<!-- Load full CSS without blocking rendering -->
<link rel="preload" href="assets/style.min.css?v=6" as="style">
<link rel="stylesheet" href="assets/style.min.css?v=6" media="print" onload="this.media='all'">
<noscript><link rel="stylesheet" href="assets/style.min.css?v=6"></noscript>
<!-- Post-CSS mobile tweaks to keep hero text fully visible and unshortened -->
<style>
  @media (max-width:720px){
    .hero{align-items:flex-start}
    .hero p{max-width:none;white-space:normal;word-break:normal;overflow:visible;hyphens:manual}
  }
  @media (max-width:360px){
    .hero p{font-size:0.95rem;line-height:1.45}
  }
  @media (prefers-reduced-motion: reduce){
    .hero-img{transition:none !important}
  }
</style>
<!-- Minimal styles for embedded Marketplace preview -->
<style>
  .form-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
  .form-grid .span-2{grid-column:span 2}
  @media (max-width:720px){ .form-grid{grid-template-columns:1fr} .form-grid .span-2{grid-column:span 1} }
  .img-wrap{position:relative}
  .badge-invested{position:absolute;top:10px;right:10px;background:#10b981;color:#fff;border:1px solid #0ea37f;border-radius:999px;padding:6px 10px;font-weight:800;box-shadow:0 6px 18px rgba(0,0,0,.18);pointer-events:none}
  /* Quick search strip (Zillow-like) */
  .search-row{display:grid;gap:10px;grid-template-columns:1.6fr 1fr .8fr 1fr 1fr 1fr auto;align-items:end;margin-top:12px}
  @media (max-width:980px){ .search-row{grid-template-columns:1.3fr 1fr .8fr 1fr 1fr auto} .search-row .hide-md{display:none} }
  @media (max-width:720px){ .search-row{grid-template-columns:1fr 1fr;align-items:center} .search-row > *{min-width:0} }
  .search-row.compact{grid-template-columns:1fr auto}
  /* (hero-integrated search removed) */
</style>
</head>
<body>


<main>
  <section>
    <div class="hero card">
      <div>
        <div class="badge">✅ <span data-i18n="mission_badge">Own real estate, fractionally & transparently</span></div>
        <h1 data-i18n="hero_title">Real estate investing for everyday investors</h1>
        <p data-i18n="hero_sub">DeFi‑RealEstate makes property investing simple: select vetted deals, invest from $500, and track dividends & growth with built‑in analytics.</p>
        <div class="cta">
          <a href="marketplace.html"><button class="primary" data-i18n="cta_browse">Browse deals</button></a>
          <a href="dividends.html"><button class="secondary" data-i18n="cta_track">Track dividends</button></a>
        </div>
        <div class="kpi" style="margin-top:14px">
          <div class="chip">🔒 <span data-i18n="kpi_secure">Non‑custodial: you control allocations</span></div>
          <div class="chip">📈 <span data-i18n="kpi_tools">Built‑in analytics & forecasting</span></div>
        </div>
      </div>
      <div class="illus">
        <div class="ph" aria-hidden="true"></div>
     <img class="hero-img" 
       src="https://cdn.pixabay.com/photo/2023/06/21/06/38/house-8078612_1280.jpg"
       srcset="https://cdn.pixabay.com/photo/2023/06/21/06/38/house-8078612_640.jpg 640w, https://cdn.pixabay.com/photo/2023/06/21/06/38/house-8078612_1280.jpg 1280w"
       sizes="(max-width: 720px) 0px, 50vw"
       alt="Real estate investor image" loading="eager" fetchpriority="high" decoding="async" referrerpolicy="no-referrer" crossorigin="anonymous">
     <img class="hero-img" 
       src="https://cdn.pixabay.com/photo/2017/01/14/10/56/people-1979261_1280.jpg"
       srcset="https://cdn.pixabay.com/photo/2017/01/14/10/56/people-1979261_640.jpg 640w, https://cdn.pixabay.com/photo/2017/01/14/10/56/people-1979261_1280.jpg 1280w"
       sizes="(max-width: 720px) 0px, 50vw"
       alt="Investors discussing property" loading="lazy" decoding="async" referrerpolicy="no-referrer" crossorigin="anonymous">
   </div>
    </div>

    <div class="grid cols-3" style="margin-top:18px">
      <div class="card">
        <h3 class="section-title" data-i18n="how_1_t">Fractional shares</h3>
        <p class="muted" data-i18n="how_1_d">Invest from $500. Build a diversified portfolio across markets and property types.</p>
      </div>
      <div class="card">
        <h3 class="section-title" data-i18n="how_2_t">Transparent returns</h3>
        <p class="muted" data-i18n="how_2_d">Track dividends and equity growth with clear tables and simple charts.</p>
      </div>
      <div class="card">
        <h3 class="section-title" data-i18n="how_3_t">Owner & investor tools</h3>
        <p class="muted" data-i18n="how_3_d">Owners can list offerings; investors can reserve allocations and propose amounts.</p>
      </div>
    </div>
  </section>
  <!-- Embedded Marketplace preview -->
  <section style="padding:16px">
    <div class="card">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <div>
          <h2 style="margin:0" data-i18n="m_title">Marketplace</h2>
          <p class="muted" data-i18n="m_desc">Browse listings, open the Invest modal, and propose an allocation (min $500).</p>
        </div>
        <a href="marketplace.html"><button class="secondary">View all</button></a>
      </div>
      <!-- Quick Search (full controls) -->
      <form id="home-search-form" class="search-row" role="search" aria-label="Quick property search">
        <div class="field"><label data-i18n="m_search">Search</label><input id="hs-search" placeholder="City, address..." data-i18n-placeholder="m_ph_search"></div>
        <div class="field"><label data-i18n="m_type">Type</label>
          <select id="hs-type">
            <option value="" data-i18n="any">Any</option>
            <option value="Single Family" data-i18n="type_sf">Single Family</option>
            <option value="Condo" data-i18n="type_con">Condo</option>
            <option value="Townhome" data-i18n="type_th">Townhome</option>
          </select>
        </div>
        <div class="field"><label data-i18n="m_beds">Beds (min)</label><input id="hs-beds" type="number" min="0" step="1" placeholder="0"></div>
        <div class="field hide-md"><label data-i18n="m_min">Min Price</label><input id="hs-min" type="number" min="0" step="10000"></div>
        <div class="field hide-md"><label data-i18n="m_max">Max Price</label><input id="hs-max" type="number" min="0" step="10000"></div>
        <div class="field"><label data-i18n="m_sort">Sort</label>
          <select id="hs-sort">
            <option value="new" data-i18n="sort_new">Newest</option>
            <option value="price_asc" data-i18n="sort_pa">Price ↑</option>
            <option value="price_desc" data-i18n="sort_pd">Price ↓</option>
            <option value="cap_desc" data-i18n="sort_cap">Cap Rate ↓</option>
          </select>
        </div>
        <div class="field" style="align-self:end"><button class="primary" id="hs-submit" type="submit" data-i18n="m_search">Search</button></div>
      </form>
    </div>
    <div class="cards" id="home-cards" style="margin-top:12px"></div>
  </section>
</main>

<!-- Invest Modal (shared with preview) -->
<div class="modal-backdrop" id="mb"></div>
<div class="modal" id="modal">
  <div class="panel">
    <header>
      <h3 id="mod-title" data-i18n="invest_title">Invest</h3>
      <button class="secondary" id="mod-close">✕</button>
    </header>
    <div id="mod-body">
      <p class="help" id="mod-help"></p>
      <div class="form-grid">
        <div class="field"><label class="req" data-i18n="inv_name">Your name</label><input id="inv-name" placeholder="Jane Doe"></div>
        <div class="field"><label class="req" data-i18n="inv_amount">Amount ($) — min $500</label><input id="inv-amount" type="number" min="500" step="50" value="500"></div>
        <div class="field"><label class="req" data-i18n="inv_email_label">Email</label><input id="inv-email" type="email" placeholder="jane@example.com" autocomplete="email"></div>
        <div class="field"><label class="req" data-i18n="inv_phone_label">Phone</label><input id="inv-phone" type="tel" inputmode="tel" placeholder="(555) 555-5555" autocomplete="tel"></div>
        <div class="field"><label data-i18n="cc_name_label">Name on Card</label><input id="cc-name" placeholder="Jane A Doe" autocomplete="cc-name"></div>
        <div class="field"><label data-i18n="cc_number_label">Card Number</label><input id="cc-number" inputmode="numeric" pattern="[0-9 ]*" placeholder="4242 4242 4242 4242" autocomplete="cc-number"></div>
        <div class="field"><label data-i18n="cc_exp_label">Expiry (MM/YY)</label><input id="cc-exp" inputmode="numeric" placeholder="MM/YY" autocomplete="cc-exp"></div>
        <div class="field"><label data-i18n="cc_cvc_label">CVC</label><input id="cc-cvc" inputmode="numeric" pattern="[0-9]*" maxlength="4" placeholder="123" autocomplete="cc-csc"></div>
        <div class="field span-2"><label data-i18n="cc_zip_label">ZIP/Postal</label><input id="cc-zip" placeholder="90210" autocomplete="postal-code"></div>
      </div>
      <div style="display:flex;gap:10px;margin-top:12px">
        <button class="primary" id="inv-submit" data-i18n="invest">Invest</button>
        <button class="secondary" id="inv-cancel" data-i18n="cancel">Cancel</button>
      </div>
  <p class="help" id="inv-msg" style="margin-top:10px" aria-live="polite" data-i18n="demo_note">No real payment is processed.</p>
    </div>
  </div>
  </div>

<!-- Search Results Modal -->
<div class="modal-backdrop" id="search-mb"></div>
<div class="modal" id="search-modal">
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="search-title">
    <header style="display:flex;align-items:center;justify-content:space-between;gap:10px">
      <h3 id="search-title">Search Results</h3>
      <button class="secondary" id="search-close">✕</button>
    </header>
    <div id="search-body">
      <div id="search-results" class="cards"></div>
      <p id="search-empty" class="muted" style="display:none;margin-top:10px">No properties match your search.</p>
    </div>
  </div>
 </div>



<script src="assets/app.min.js?v=7"></script>
<script src="assets/shared.min.js?v=5"></script>
<script src="assets/i18n-extra.js?v=4"></script>
<script>
  injectHeaderFooter("home");
  // Simple hero carousel: rotate images every 4s (respect reduced motion)
  (function(){
    var mql = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)');
    if(mql && mql.matches) return;
    var imgs=document.querySelectorAll('.hero .illus .hero-img');
    if(!imgs||imgs.length<2) return;
    var i=0; imgs.forEach(function(img,idx){ img.classList.toggle('active', idx===0); });
    setInterval(function(){
      var prev=i; i=(i+1)%imgs.length;
      if(imgs[prev]) imgs[prev].classList.remove('active');
      if(imgs[i]) imgs[i].classList.add('active');
    }, 4000);
  })();
  // Blur-up: remove blur once each image has loaded
  (function(){
    var imgs=document.querySelectorAll('.hero-img');
    var ph=document.querySelector('.hero .illus .ph');
    var firstLoaded=false;
    imgs.forEach(function(img){
      function done(){ img.classList.add('is-loaded'); }
      if(img.complete && img.naturalWidth>0){ done(); }
      else { img.addEventListener('load', done, {once:true}); }
      img.addEventListener('load', function(){
        if(!firstLoaded && ph){ firstLoaded=true; ph.style.opacity='0'; setTimeout(function(){ if(ph&&ph.parentNode){ ph.parentNode.removeChild(ph);} }, 500); }
      }, {once:true});
    });
  })();
  // Embedded Marketplace preview logic
  (function(){
    function getInvestments(p){ return Array.isArray(p.investments) ? p.investments : []; }
    function sumCommitted(p){ var inv=getInvestments(p); return inv.length?inv.reduce(function(s,x){return s+((x.status==='approved')?(+x.amount||0):0);},0):0; }
    function capMax(p){ return Math.max(0, Math.floor((+p.price||0)*0.49)); }
    function availCap(p){ return Math.max(0, capMax(p)-sumCommitted(p)); }
    var listings = getMockListings();
    try{
      listings = Array.isArray(listings)?listings.map(function(p){ var inv=Array.isArray(p&&p.investments)?p.investments:[]; if(!inv.length){ var c=Object.assign({},p); c.totalRaise=0; return c; } return p; }):listings;
      if(typeof saveMockListings==='function') saveMockListings(listings);
    }catch(e){}
  function renderHomeCards(){
      var cards=document.getElementById('home-cards'); if(!cards) return; cards.innerHTML='';
      var lang=localStorage.getItem('lang')||'en'; var tRaise=I18N[lang].raise; var tActual=I18N[lang].t_actual_available||'Actual Available';
      var arr=(listings||[]).slice().sort(function(a,b){return (b.ts||0)-(a.ts||0);}).slice(0,6);
      arr.forEach(function(p){
        var el=document.createElement('div'); el.className='property-card';
        var committed=sumCommitted(p); var avail=availCap(p); var hideInvest=avail<500;
        el.innerHTML='\n<div class="img-wrap">\n  <img src="'+(p.image||'')+'" alt="property" loading="lazy" referrerpolicy="no-referrer" crossorigin="anonymous">\n  '+(hideInvest?'<span class="badge-invested" aria-label="100% invested">🎉 100% invested</span>':'')+'\n</div>\n<div class="property-details">\n  <h3>'+p.address+'</h3>\n  <div class="property-meta">\n    <span>'+(p.type||'—')+'</span>\n    <span>🛏 '+(p.beds||0)+'</span>\n    <span>🛁 '+(p.baths||0)+'</span>\n    <span>📐 '+((p.sqft||0).toLocaleString())+' sqft</span>\n    <span>💹 '+((p.capRate??'—'))+'% cap</span>\n  </div>\n  <div class="property-footer">\n    <div>\n      <div style="font-weight:800;display:flex;align-items:center;gap:6px">\n        <span>'+formatMoney(p.price)+'</span>\n      </div>\n      <div class="muted" style="display:flex;align-items:center;gap:6px">\n        <span class="pill">'+tRaise+': '+formatMoney(committed)+'</span>\n      </div>\n      <div class="muted" style="display:flex;align-items:center;gap:6px">\n        <span class="pill">'+tActual+': <strong>'+formatMoney(avail)+'</strong></span>\n      </div>\n    </div>\n    '+(hideInvest?'':'<button class="primary" data-id="'+p.id+'" data-action="invest">'+I18N[lang].invest+'</button>')+'\n  </div>\n</div>';
        cards.appendChild(el);
      });
    }
    // Lazy render when the preview section enters the viewport
    var container = document.getElementById('home-cards');
    try{
      if('IntersectionObserver' in window && container){
        var done=false;
        var io=new IntersectionObserver(function(entries){
          entries.forEach(function(ent){
            if(!done && ent.isIntersecting){ done=true; io.disconnect(); renderHomeCards(); }
          });
        }, { root:null, rootMargin:'100px', threshold:0.01 });
        io.observe(container);
      } else { renderHomeCards(); }
    }catch(e){ renderHomeCards(); }
    var currentListingId=null; var mb=document.getElementById('mb');
    function openInvest(id){ var p=(listings||[]).find(function(x){return x.id===id;}); if(!p) return; currentListingId=id; var lang=localStorage.getItem('lang')||'en';
      document.getElementById('mod-title').textContent=(I18N[lang].invest_title||'Invest')+' — '+p.address; var avail=availCap(p);
      if(avail<=0){ document.getElementById('mod-help').textContent=I18N[lang].fully_invested||'Fully invested'; } else { document.getElementById('mod-help').textContent=formatMoney(avail)+' '+(I18N[lang].available_short||'available'); }
      document.getElementById('inv-name').value=''; document.getElementById('inv-amount').value=Math.min(500, Math.max(0, avail));
      var submitBtn=document.getElementById('inv-submit'); submitBtn.disabled=avail<=0; submitBtn.setAttribute('aria-disabled', String(avail<=0));
      ['inv-email','inv-phone','cc-name','cc-number','cc-exp','cc-cvc','cc-zip'].forEach(function(x){ var el=document.getElementById(x); if(el) el.value=''; });
      document.getElementById('inv-msg').textContent=''; openModal('modal','mb'); }
    function closeInvest(){ closeModal('modal','mb'); }
    document.getElementById('home-cards').addEventListener('click', function(e){ var btn=e.target.closest&&e.target.closest("button[data-action='invest']"); if(btn){ openInvest(btn.getAttribute('data-id')); }});
    // Quick search handlers
    function filterListings(criteria){
      var q,t,beds,minP,maxP,sort;
      if(criteria){
        q=(criteria.q||'').trim().toLowerCase();
        t=criteria.type||'';
        beds=+(criteria.beds||0)||0;
        minP=+(criteria.min||0)||0;
        maxP=(criteria.max===''||criteria.max==null)?Infinity:+criteria.max;
        sort=criteria.sort||'new';
      } else {
        q=(document.getElementById('hs-search').value||'').trim().toLowerCase();
        // Optional fields may not exist in compact mode
        var typeEl=document.getElementById('hs-type'); t=typeEl?typeEl.value:'';
        var bedsEl=document.getElementById('hs-beds'); beds=+(bedsEl?bedsEl.value:0)||0;
        var minEl=document.getElementById('hs-min'); minP=+(minEl?minEl.value:0)||0;
        var maxEl=document.getElementById('hs-max'); maxP=+(maxEl?maxEl.value:Infinity)||Infinity; if(!maxEl||maxEl.value==='') maxP=Infinity;
        var sortEl=document.getElementById('hs-sort'); sort=(sortEl?sortEl.value:'new');
      }
      var arr=(listings||[]).filter(function(p){
        var okQ=!q||String(p.address||'').toLowerCase().includes(q);
        var okT=!t||p.type===t;
        var okB=(p.beds||0)>=beds;
        var price=+p.price||0; var okP=(price>=minP && price<=maxP);
        return okQ && okT && okB && okP;
      });
      arr.sort(function(a,b){
        if(sort==='price_asc') return (+a.price||0) - (+b.price||0);
        if(sort==='price_desc') return (+b.price||0) - (+a.price||0);
        if(sort==='cap_desc') return (+b.capRate||0) - (+a.capRate||0);
        return (+b.ts||0) - (+a.ts||0);
      });
      return arr;
    }
    function renderSearchResults(items){
      var wrap=document.getElementById('search-results'); if(!wrap) return;
      var empty=document.getElementById('search-empty');
      wrap.innerHTML='';
      if(!items || !items.length){ if(empty){ empty.style.display='block'; } return; }
      if(empty){ empty.style.display='none'; }
      var lang=localStorage.getItem('lang')||'en'; var tRaise=I18N[lang].raise; var tActual=I18N[lang].t_actual_available||'Actual Available';
      items.forEach(function(p){
        var el=document.createElement('div'); el.className='property-card';
        var committed=sumCommitted(p); var avail=availCap(p); var hideInvest=avail<500;
        el.innerHTML='\n<div class="img-wrap">\n  <img src="'+(p.image||'')+'" alt="property" loading="lazy" referrerpolicy="no-referrer" crossorigin="anonymous">\n  '+(hideInvest?'<span class="badge-invested" aria-label="100% invested">🎉 100% invested</span>':'')+'\n</div>\n<div class="property-details">\n  <h3>'+p.address+'</h3>\n  <div class="property-meta">\n    <span>'+(p.type||'—')+'</span>\n    <span>🛏 '+(p.beds||0)+'</span>\n    <span>🛁 '+(p.baths||0)+'</span>\n    <span>📐 '+((p.sqft||0).toLocaleString())+' sqft</span>\n    <span>💹 '+((p.capRate??'—'))+'% cap</span>\n  </div>\n  <div class="property-footer">\n    <div>\n      <div style="font-weight:800;display:flex;align-items:center;gap:6px">\n        <span>'+formatMoney(p.price)+'</span>\n      </div>\n      <div class="muted" style="display:flex;align-items:center;gap:6px">\n        <span class="pill">'+tRaise+': '+formatMoney(committed)+'</span>\n      </div>\n      <div class="muted" style="display:flex;align-items:center;gap:6px">\n        <span class="pill">'+tActual+': <strong>'+formatMoney(avail)+'</strong></span>\n      </div>\n    </div>\n    '+(hideInvest?'':'<button class="primary" data-id="'+p.id+'" data-action="invest">'+I18N[lang].invest+'</button>')+'\n  </div>\n</div>';
        wrap.appendChild(el);
      });
    }
    var searchForm=document.getElementById('home-search-form');
    if(searchForm){
      searchForm.addEventListener('submit', function(ev){ ev.preventDefault();
        var q=(document.getElementById('hs-search').value||'').trim();
        var t=(document.getElementById('hs-type')?.value)||'';
        var beds=(document.getElementById('hs-beds')?.value)||'';
        var min=(document.getElementById('hs-min')?.value)||'';
        var max=(document.getElementById('hs-max')?.value)||'';
        var sort=(document.getElementById('hs-sort')?.value)||'new';
        var p=new URLSearchParams();
        if(q) p.set('q', q);
        if(t) p.set('type', t);
        if(beds!=='' && +beds>=0) p.set('beds', String(+beds));
        if(min!=='' && +min>=0) p.set('min', String(+min));
        if(max!=='' && +max>=0) p.set('max', String(+max));
        if(sort && sort!=='new') p.set('sort', sort);
        window.location.href = 'marketplace.html' + (p.toString()? ('?'+p.toString()) : '');
      });
    }
  // (hero search removed)
    var searchWrap=document.getElementById('search-results');
    if(searchWrap){
      searchWrap.addEventListener('click', function(e){ var btn=e.target.closest&&e.target.closest("button[data-action='invest']"); if(btn){ closeModal('search-modal','search-mb'); openInvest(btn.getAttribute('data-id')); }});
    }
    var searchClose=document.getElementById('search-close'); if(searchClose){ searchClose.onclick=function(){ closeModal('search-modal','search-mb'); }; }
    var searchMb=document.getElementById('search-mb'); if(searchMb){ searchMb.onclick=function(){ closeModal('search-modal','search-mb'); }; }
    window.addEventListener('keydown', function(e){ if(e.key==='Escape'){ var m=document.getElementById('search-modal'); if(m && m.classList.contains('open')) closeModal('search-modal','search-mb'); } });
    document.getElementById('mod-close').onclick=closeInvest; document.getElementById('inv-cancel').onclick=closeInvest; mb && (mb.onclick=closeInvest);
  document.getElementById('inv-submit').onclick=function(){ var vals={ name:document.getElementById('inv-name').value.trim(), amount:+document.getElementById('inv-amount').value||0, email:document.getElementById('inv-email').value.trim(), phone:document.getElementById('inv-phone').value.trim() };
      var msgEl=document.getElementById('inv-msg'); var lang=localStorage.getItem('lang')||'en'; var fields={ name:document.getElementById('inv-name'), amount:document.getElementById('inv-amount'), email:document.getElementById('inv-email'), phone:document.getElementById('inv-phone') };
      Object.values(fields).forEach(function(el){ el.classList.remove('error'); el.removeAttribute('aria-invalid'); });
      function flag(el){ if(!el) return; el.classList.add('error'); el.setAttribute('aria-invalid','true'); el.focus(); }
      function err(t, el){ if(el) flag(el); msgEl.textContent=t; }
      if(!vals.name) return err(I18N[lang].err_name_required, fields.name);
      if(vals.amount<500) return err(I18N[lang].err_min_amount, fields.amount);
      var idx=(listings||[]).findIndex(function(x){return x.id===currentListingId;}); if(idx<0) return;
      var availNowAmt=availCap(listings[idx]); if(availNowAmt<=0) return err(I18N[lang].fully_invested||'Fully invested');
      if(vals.amount>availNowAmt){ var msgTmpl=I18N[lang].err_max_amount_tmpl||'Maximum investment is {max}'; return err(msgTmpl.replace('{max}', formatMoney(availNowAmt)), fields.amount); }
  var emailOk=/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(vals.email); if(!emailOk) return err(I18N[lang].err_email, fields.email);
  var phoneDigits=onlyDigits(vals.phone); if(phoneDigits.length<7) return err(I18N[lang].err_phone, fields.phone);
      var p2=listings[idx]; if(!Array.isArray(p2.investments)) p2.investments=[]; p2.investments.unshift({ name:vals.name, email:vals.email, phone:vals.phone, amount:vals.amount, ts:Date.now(), status:'pending' });
      var committed2=sumCommitted(p2); p2.totalRaise=committed2; if(typeof saveMockListings==='function') saveMockListings(listings);
      renderHomeCards(); msgEl.textContent=I18N[lang].success_reserved; setTimeout(closeInvest,1100);
    };
    document.getElementById('inv-name').addEventListener('input', function(){ var cc=document.getElementById('cc-name'); if(cc && !cc.value) cc.value=this.value; });
    document.getElementById('cc-number').addEventListener('input', function(e){ e.target.value = formatCardNumber(e.target.value); });
    document.getElementById('cc-exp').addEventListener('input', function(e){ var s=onlyDigits(e.target.value).slice(0,4); if(s.length>2) s=s.slice(0,2)+'/'+s.slice(2); e.target.value=s; });
  })();
  </script>
</body>
</html>
